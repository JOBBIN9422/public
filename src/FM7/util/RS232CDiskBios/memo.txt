動作確認 []は確認した機種 (なおコマンド例の"2"というのはポート番号なので環境に応じて書き換える)
  F-BASIC 3.0 [実機AV40]
    起動確認。
    なお、F-BASIC 3.0のディスクでうまく動作しないものは、オプションに、
        -install2 7F25
    をつけてやるとDisk BASICのエラーメッセージ領域に常駐するので動作するかもしれない。
    エラーが出るとクラッシュするかもしれない。

    F-BASICから起動確認したのは、
      FM-7 DEMO1 [実機AV40]
      FM-7 DEMO2 [実機AV40]
      Emergency [実機AV40]

  URADOS [実機AV40]
    起動確認。ただし$7F9Fまでしか使えない。なお、インストールアドレスを指定しなかったらサーバー
    はURADOSを自動判別してインストールアドレスを7F80に変更する。URADOSはFC00〜を使ってしまうの
    でデフォルトの位置にはインストールできない。

  R-DOS
    DOSモードで起動してくるものなので、サーバーオプション -dosmode が必要。DOSモードというのは、
    単に$8000〜$FBFFがRAMモードで、IPLが$0300からにロードされるというものなので、インストーラ
    がそのような状態にしてIPLにジャンプすることで対応。

  (非公式対応)Thexder [実機AV40]
    FC00〜FCFFはThexderが使うので、インストール先を変更する必要あり。
    例:
      RS232CDiskBios thexder.d77 2 -install 0040

  (非公式対応)MAGUS [実機AV40]
    FC00〜FCFFはMAGUSがスタックとして使うのでインストール先を変更する必要あり。
    例:
      RS232CDiskBios magus.d77 2 -install 0040

  (非公式対応)A列車で行こう [実機AV40]
    起動中にメインCPUのRAMをほぼ全域使ってしまうので、Disk BAISCのエラーメッセージ領域をつぶして
    BIOSフックをインストールしなくてはならないが、IPLがDisk BASICを読み込み中はBIOSフックは別の
    場所に無いと起動しないので、IPL中とIPL後で別のアドレスにBIOSフックをインストールすることで
    起動できる。
    例:
      RS232CDiskBios magus.d77 2 -install2 7F25

  (非公式対応)大戦略FM [実機AV40]
    普通にそのまま起動した。パラメータ不要。



失敗
  F-BASIC 3.3
    起動まではするのだが、その後RS232Cじゃなくて普通にディスクドライブを読みに行ってしまう。
    MMRを使いまくっているようでFC00〜に常駐だと無理。またF-BASICに制御を移す移し方も違って
    いるようで、Carry=0でJMP [$FBFE]としているから、初期化後にBIOSフックを再インストールで
    きなさそう。しかも4000と2000と6000と3か所にインストーラをコピーしているのにすべて消滅
    してた。




インストーラ

$6000から(デフォルト)にロード。実行すると、
(1) BIOSのオーバーライドをインストール
(2) RS232Cからトラック0サイド0セクタ1をRS232Cから$0100からに読み込み
(3) ブート後の再インストールに備えて自身の NOP NOP を PULS A,B,X,Y,U,CC,DP,PC に書き換え。
(4) ブート後の再インストールに備えて自信を 0x2000-0x20FF, 0x4000-0x40FF にコピーする。(URADOSで0x2000のクローンを使用)
(5) $0100にジャンプ

Disk BASICが起動するとオーバーライドなどすべてクリアしてしまうので、再度インストールする必要がある。

Disk BASICのIPLは

   0170 8E 6E 00       LDX   #$6E00
   0173 43             COMA
   0174 6E 9F FB FE    JMP   [$FBFE]

これでF-BASIC ROMの初期化ルーチンに飛ぶ。この中で 0〜6DFF をクリアして 6E00 にジャンプする。これをサーバー側で、LDX #$6E00とJMP [$FBFE]の存在をチェックして、両方とも含む場合は、LDX #$6D00に書き換える。これにより、Disk BASIC起動時に再度BIOSオーバーライドをインストールする。



URADOSの場合 変更点3か所
  デフォルトインストールアドレスは7F80にする (FC00〜はURADOSが使用)
  インストーラのJMP $6E00をJMP $4D00にする (URADOSの初期化は$4D00〜)
  IPLはLDX #$4D00をLDX #$2000にする
  セクタ内容の変更で LBEQ $FE08, JMP $FE05 をそれぞれ LBEQ FE08_Hook, JMP FE05_Hook にする(自動)

これによりURADOSも起動可能。ただし使用可能なコンベンショナル領域は0x7F7Fまで。(URADOSネイティブは 0x7FFF)。またURADOSのLOAD "COM0:"もRS232Cはフックが使ってしまうから使えない。

